{"version":3,"file":"CommentModel.js","sourceRoot":"","sources":["../../../src/models/CommentModel.ts"],"names":[],"mappings":"AAAA,OAAO,QAAQ,EAAE,EAAE,MAAM,EAAmB,MAAM,UAAU,CAAC;AAc7D,MAAM,aAAa,GAAG,IAAI,MAAM,CAC9B;IACE,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;IAClE,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;IAClE,IAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;IACtC,KAAK,EAAE,CAAC,EAAE,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC;IAClE,yEAAyE;CAC1E,EACD,EAAE,UAAU,EAAE,IAAI,EAAE,CACrB,CAAC;AAEF,aAAa,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,GAAG,CAAC;IACtC,4BAA4B;IAC5B,OAAO,CAAC,IAAI,CAAC,KAAK,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,8BAA8B;AAClE,CAAC,CAAC,CAAC;AAEH,aAAa,CAAC,GAAG,CAAC,QAAQ,EAAE;IAC1B,QAAQ,EAAE,IAAI;IACd,UAAU,EAAE,KAAK;IACjB,SAAS,EAAE,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE;QACvB,4BAA4B;QAC5B,OAAO,GAAG,CAAC,EAAE,CAAC,CAAC,gBAAgB;QAC/B,OAAO,GAAG,CAAC;IACb,CAAC;CACF,CAAC,CAAC;AACH,aAAa,CAAC,GAAG,CAAC,UAAU,EAAE,EAAE,QAAQ,EAAE,IAAI,EAAE,CAAC,CAAC;AAElD,eAAe,QAAQ,CAAC,KAAK,CAAW,SAAS,EAAE,aAAa,CAAC,CAAC","sourcesContent":["import mongoose, { Schema, Document, Types } from 'mongoose';\r\n\r\nexport interface IComment extends Document {\r\n  _id: Types.ObjectId;\r\n  user: Types.ObjectId; // Автор комментария\r\n  post: Types.ObjectId; // К какому посту\r\n  text: string;\r\n  likes: Types.ObjectId[];\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  likesCount?: number;\r\n  // author: Types.ObjectId;    // автора поста (для прав доступа)\r\n}\r\n\r\nconst CommentSchema = new Schema<IComment>(\r\n  {\r\n    user: { type: Schema.Types.ObjectId, ref: 'User', required: true },\r\n    post: { type: Schema.Types.ObjectId, ref: 'Post', required: true },\r\n    text: { type: String, required: true },\r\n    likes: [{ type: Schema.Types.ObjectId, ref: 'User', default: [] }],\r\n    // author: Types.ObjectId // дублировало `user`. Автор комментария = user\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nCommentSchema.virtual('likesCount').get(function (this: IComment) {\r\n  // return this.likes.length;\r\n  return (this.likes ?? []).length; //для устойчивости к undefined\r\n});\r\n\r\nCommentSchema.set('toJSON', {\r\n  virtuals: true,\r\n  versionKey: false,\r\n  transform: (_doc, ret) => {\r\n    // ret.id = String(ret._id);\r\n    delete ret.id; // ← убираем _id\r\n    return ret;\r\n  },\r\n});\r\nCommentSchema.set('toObject', { virtuals: true });\r\n\r\nexport default mongoose.model<IComment>('Comment', CommentSchema);\r\n"]}